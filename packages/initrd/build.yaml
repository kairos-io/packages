requires:
- name: "{{.Values.name}}"
  category: "distro-kernels"
  version: ">=0"

copy:
# The toolkit is required in module-setup and embedded in the initramfs. 
- package: 
    category: "system"
    name: "elemental-toolkit-{{.Values.name}}"
    version: ">=0"
  source: "/framework/."
  destination: "/"
- package: 
    category: "system"
    name: "elemental-cli"
    version: ">=0"
  source: "/usr/bin/elemental"
  destination: "/usr/bin/elemental"
- package: 
    category: "dracut"
    name: "kcrypt"
    version: ">=0"
  source: "/package/."
  destination: "/"
- package: 
    category: "system"
    name: "kcrypt"
    version: ">=0"
  source: "/usr/bin/kcrypt"
  destination: "/usr/bin/kcrypt"
prelude:
# remove if any
- rm -rf /boot/initrd || true

steps:
# Create initrd
- |
    kernel=$(ls /lib/modules | head -n1) && \
    dracut -f "/boot/initrd-${kernel}" "${kernel}" && \
    ln -sf "initrd-${kernel}" /boot/initrd